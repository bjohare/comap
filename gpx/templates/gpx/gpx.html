{% extends "comap/base.html" %}
{% load staticfiles %}
{% block container %}
<br/><br/><br/>
<h2>Upload a GPX File</h2>
    <form id="gpxForm" action="{% url 'gpx:gpx' %}" method="post"
          enctype="multipart/form-data" role="form">
    {% csrf_token %}
    <div class="form-group row" id="form-group-name">
        <div class="col-md-6">
            <strong><label class="control-label" for="name">Layer name: </label></strong>
            <input class="form-control" type="text" name="name" id="name" value="" 
            <span class="help-inline">Provide a name for this layer..</span>
        </div>
    </div>
    <div class="form-group row" id="form-group-description">
        <div class="col-md-6">
            <strong><label class="control-label" for="description">Layer Description: </label></strong>
            <textarea name="description" id="description" class="tinymce form-control">Provide a description for this layer..</textarea>
        </div>
    </div>
    <div class="form-group row">
     <div class="col-md-6" style="float:left;">
            <strong><label class="control-label" for="gpxfile">Select a GPX file to upload: </label></strong>
            <input type="file" name="gpxfile" id="file"/> 
     </div>
    </div>
    <div class="form-group row">
     <div class="col-md-6" style="float:left;">
            <strong><label class="control-label" for="type">Select data type: </label></strong>
            <label for="data_type_0">Track: </label>  <input type="radio" name="data_type" id="data_type_0" value="tracks"/>
            <label for="data_type_1">Waypoint: </label>  <input type="radio" name="data_type" id="data_type_1" value="waypoints"/>
     </div>
    </div>
    <div class="form-group row pull-left">
        <div class="col-md-6">
            <button id="save" type="submit" class="btn btn-default">Upload GPX</button>
        </div>
    </div>
    <div class="form-group row">
        <div class="col-md-6">
          <div id="progressbar">
                  <div class="progress-label"></div>
           </div>
        </div>
    </div>   
    </form>
    </div>
    <!-- gpx processing results -->
    <div id="info" class="pull-left info"></div>
    
{% endblock %}
{% block corejs %}
{{ block.super }}
<script src="{% static "waypoints/js/EditMap.js" %}" type="text/javascript" defer></script>
<script src="{% static "js/tinymce/js/tinymce/jquery.tinymce.min.js" %}" type="text/javascript"></script>
<script src="http://malsup.github.com/jquery.form.js"></script> 
<script type="text/javascript">
    $(function() {
            $('textarea.tinymce').tinymce({
                    // Location of TinyMCE script
                    script_url : '{% static "js/tinymce/js/tinymce/tinymce.min.js" %}',
                    
                    // General options
                    selector: "textarea",
                    theme : "modern",
                    menubar: false,
                    plugins: [
                        "advlist autolink lists link charmap hr anchor",
                        "searchreplace wordcount visualblocks visualchars code fullscreen",
                        "insertdatetime nonbreaking contextmenu directionality",
                    ],
                    toolbar1: "undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link",
                    width:600,
                    height:248,
            });
    });
</script>

<!-- load map -->
<script type="text/javascript">
    var editMap;
    $(document).ready(function() {
        
    });
    
    /* progressbar stuff */
    var progressbar = $('#progressbar').progressbar();
    $('#progressbar').css("display","none");
    $('#gpxForm').ajaxForm({
        beforeSubmit: function(arr, $form, options) {
            $('#progressbar').css("display","block");
        },
        uploadProgress: function(event, position, total, percentComplete) {
            progressbar.progressbar({value: percentComplete});
        },
        success: function(data, status, xrh) {
            $('#progressbar').css("display","none");
            console.log('success')
        },
        error: function(xhr, status, error){
            $('#progressbar').css("display", "none");
            $('#info').empty();
            var json = xhr.responseJSON
            errors = json.errors;
            $('#info').addClass('error');
            $('#info').append('<h3>Please correct these errors:</h3>');
            $.each(errors, function(i, error){
                console.log(error);
                $('#form-group-' + error).addClass('has-error');
                $('#info').append('<p><strong>' + error + '</strong> is a required field.</h4>');
            });
        },
    });
</script>
{% endblock %}
